<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Your Cart</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f8f8f8;
      margin: 0;
      padding: 40px;
    }

    h1 {
      text-align: center;
      font-size: 32px;
      margin-bottom: 40px;
    }

    .cart-table {
      width: 100%;
      max-width: 1000px;
      margin: 0 auto;
      border-collapse: collapse;
      background: #fff;
      box-shadow: 0 0 10px rgba(0,0,0,0.05);
    }

    .cart-table thead th {
      text-align: left;
      padding: 16px 20px;
      font-size: 16px;
      background: #fff;
      border-bottom: 1px solid #ddd;
    }

    .cart-item {
      display: flex;
      align-items: center;
      padding: 20px;
      border-bottom: 1px solid #eee;
    }

    .cart-item img {
      width: 100px;
      height: auto;
      margin-right: 20px;
      border: 1px solid #ddd;
    }

    .item-info {
      flex: 1;
    }

    .item-info h3 {
      margin: 0;
      font-size: 16px;
    }

    .item-info small {
      color: #666;
    }

    .quantity-control {
      width: 60px;
      text-align: center;
      border: 1px solid #ccc;
      border-radius: 6px;
      padding: 8px;
      margin-right: 16px;
    }

    .remove-link {
      color: #888;
      font-size: 14px;
      text-decoration: underline;
      cursor: pointer;
    }

    .total-price {
      text-align: right;
      padding: 20px;
      font-weight: bold;
      font-size: 18px;
    }

    .cart-buttons {
      display: flex;
      justify-content: space-between;
      max-width: 1000px;
      margin: 30px auto 0;
    }

    .cart-buttons button {
      padding: 12px 20px;
      font-size: 16px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    .back-btn {
      background: #ccc;
    }

    .checkout-btn {
      background: #000;
      color: #fff;
    }
  </style>
</head>
<body>

  <h1>Your Cart</h1>

  <table class="cart-table">
    <thead>
      <tr>
        <th>Product</th>
        <th>Quantity</th>
        <th>Total</th>
      </tr>
    </thead>
    <tbody id="cartBody"></tbody>
  </table>

  <div class="total-price" id="grandTotal">Total: RM0.00</div>

  <div class="cart-buttons">
    <button class="back-btn" onclick="window.location.href='index.html'">← Go Back</button>
    <button class="checkout-btn" onclick="checkout()">Proceed to Payment →</button>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBa1fzqUYWAshoF1zK2x2m1XuR2eMEw8s",
      authDomain: "uproject-2e3c7.firebaseapp.com",
      projectId: "uproject-2e3c7",
      storageBucket: "uproject-2e3c7.appspot.com",
      messagingSenderId: "161272239397",
      appId: "1:161272239397:web-3bb6f53fd53e61934c4504",
      measurementId: "G-96RNXJ8J7X"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const cartBody = document.getElementById("cartBody");
    const grandTotal = document.getElementById("grandTotal");

    db.ref("cart").once("value").then(snapshot => {
      const data = snapshot.val();
      let total = 0;
      if (data) {
        Object.entries(data).forEach(([key, item]) => {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>
              <div class="cart-item">
                <img src="img/boxyshirt.png" alt="${item.name}" />
                <div class="item-info">
                  <h3>${item.name}</h3>
                  <small>RM${item.price} MYR</small><br>
                  <small>Size: Free</small>
                </div>
              </div>
            </td>
            <td style="text-align:center;">
              <input class="quantity-control" type="number" value="1" min="1" readonly />
              <div class="remove-link" onclick="removeItem('${key}')">Remove</div>
            </td>
            <td style="text-align:right;">RM${item.price}</td>
          `;
          cartBody.appendChild(row);
          total += parseFloat(item.price);
        });
      } else {
        cartBody.innerHTML = '<tr><td colspan="3" style="text-align:center;">Your cart is empty.</td></tr>';
      }
      grandTotal.textContent = "Total: RM" + total.toFixed(2);
    });

    function removeItem(key) {
      if (confirm("Remove this item from cart?")) {
        firebase.database().ref("cart/" + key).remove().then(() => location.reload());
      }
    }

    function checkout() {
      const totalAmount = document.getElementById("grandTotal").textContent.replace("Total: RM", "").trim();
      const confirmationMessage = `
        You're about to purchase the following:

        Total Amount: RM ${totalAmount}

        Please confirm to proceed to payment.
      `;

      const confirmed = confirm(confirmationMessage);

      if (confirmed) {
        // Simulate a successful transaction
        alert("Payment successful! Thank you for your purchase.");
        
        // Clear the cart and redirect to a "Thank You" page
        db.ref("cart").remove().then(() => {
          alert("Your cart has been cleared.");
          window.location.href = "thankyou.html"; // Example redirect to a thank you page
        });
      } else {
        // If the user cancels the checkout
        alert("Payment cancelled. You can continue shopping.");
      }
    }
  </script>

</body>
</html>
